---
title: "Exploratory Data Analyses for PER Project"
author: "Ian Kahrilas"
date: "1/21/2020"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
# load in dataset
per_erp <- read_csv("per_erp.csv")
library(pander)
library(ggpubr)
library(car)
library(moments)
```

## Questionnaire Descriptive Statisitcs

```{r descriptive stats on variables of interest}
per_erp %>% 
  summarize("PA Mean" = mean(pos_affectivity, na.rm = TRUE),
            "PA SD" = sd(pos_affectivity, na.rm = TRUE),
            "NA Mean" = mean(neg_affectivity, na.rm = TRUE),
            "NA SD" = sd(neg_affectivity, na.rm = TRUE),
            "StM Mean" = mean(savoring_moment, na.rm = TRUE),
            "StM SD" = sd(savoring_moment, na.rm = TRUE),
            "Anticipating Mean" = mean(anticipating, na.rm = TRUE),
            "Anticipating SD" = sd(anticipating, na.rm = TRUE),
            "Reminiscing Mean" = mean(reminiscing, na.rm = TRUE),
            "Reminiscing SD" = sd(reminiscing, na.rm = TRUE)) %>% 
  pander(split.tables = 200, caption = "PA = Positive Affectivity, NA = Negative Affectivity, StM = Savoring the Moment")
```

## LPP Descriptive Statistics by Block

```{r descriptive statistics for LPP}
per_erp %>% 
  group_by(block) %>% 
  summarize("LPP Mean" = mean(LPP, na.rm = TRUE),
            "LPP SD" = sd(LPP, na.rm = TRUE)) %>% 
  pander()
```

## Positive Affectivity

```{r PA histogram}
per_erp %>% 
  group_by(pid) %>% 
  summarize(pos_affectivity = mean(pos_affectivity, na.rm = TRUE)) %>% 
  ggplot(., (aes(pos_affectivity))) +
    geom_histogram(bins = 15) +
    ggtitle("PA Histogram")
```
```{r PA QQplot}
per_erp %>% 
  group_by(pid) %>% 
  summarize(pos_affectivity = mean(pos_affectivity, na.rm = TRUE)) %>% 
  ggplot(., aes(sample = pos_affectivity)) + 
  stat_qq() +
  stat_qq_line() +
  ggtitle("PA QQPlot")
```

It would appear that there is a slight negative skew to the data, though it does not deviate from a gaussian distribution substantially. Let's confirm with a shapiro-wilk test for normality

```{r shapiro-wilk test for positive affectivity, echo = FALSE}
pid_pa <- per_erp %>% 
  group_by(pid) %>% 
  summarize(pos_affectivity = mean(pos_affectivity, na.rm = TRUE))
shapiro.test(pid_pa$pos_affectivity) %>% 
  pander()
rm(pid_pa)
```
It is not significant, suggesting that the distribution of PA does not significantly deviate from the normal distribution.

## Negative Affectivity

```{r negative affectivity histogram}
per_erp %>% 
  group_by(pid) %>% 
  summarize(neg_affectivity = mean(neg_affectivity, na.rm = TRUE)) %>% 
  ggplot(., (aes(neg_affectivity))) +
    geom_histogram(bins = 15) +
    ggtitle("NA Histogram")
```
```{r negative affectivity qqplot}
per_erp %>% 
  group_by(pid) %>% 
  summarize(neg_affectivity = mean(neg_affectivity, na.rm = TRUE)) %>% 
  ggplot(., aes(sample = neg_affectivity)) + 
  stat_qq() +
  stat_qq_line() +
  ggtitle("NA QQPlot")
```
```{r shapiro-wilk test for NA}
pid_na <- per_erp %>% 
  group_by(pid) %>% 
  summarize(neg_affectivity = mean(neg_affectivity, na.rm = TRUE))
shapiro.test(pid_na$neg_affectivity) %>% 
  pander()
rm(pid_na)
```
NA does not significantly deviate from the normal distribution.

## Savoring the Moment

```{r StM histogram}
per_erp %>% 
  group_by(pid) %>% 
  summarize(savoring_moment = mean(savoring_moment, na.rm = TRUE)) %>% 
  ggplot(., (aes(savoring_moment))) +
    geom_histogram(bins = 25) +
    ggtitle("Savoring the Moment Histogram")
```
```{r StM qqplot}
per_erp %>% 
  group_by(pid) %>% 
  summarize(savoring_moment = mean(savoring_moment, na.rm = TRUE)) %>% 
  ggplot(., aes(sample = savoring_moment)) + 
  stat_qq() +
  stat_qq_line() +
  ggtitle("Savoring the Moment QQPlot")
```
```{r shapiro-wilk test for StM}
pid_StM <- per_erp %>% 
  group_by(pid) %>% 
  summarize(savoring_moment = mean(savoring_moment, na.rm = TRUE))
shapiro.test(pid_StM$savoring_moment) %>% 
  pander()
rm(pid_StM)
```

## LPP

### Histograms, and QQplots for each block
```{r histograms and qqplots for LPP for each block, warning = FALSE}
LPP_by_pid <- per_erp %>% 
  group_by(pid, block) %>% 
  summarize(LPP = mean(LPP, na.rm = TRUE))

LPP_hist_qq <- function(cond, title) {
LPP_by_pid %>% 
  filter(block == cond) %>% 
  gghistogram(., "LPP", title = title) %>% 
    print()
LPP_by_pid %>% 
  filter(block == cond) %>% 
  ggqqplot(., "LPP", title = title)
}

conditions <- unique(LPP_by_pid$block)
cond_names <- c(paste("Negative", c("Decrease", "Increase", "Watch")), "Neutral Watch", paste("Positive", c("Decrease", "Increase", "Watch")))

map2(conditions, cond_names, ~ LPP_hist_qq(cond = .x, title = .y))
```

```{r shapiro-wilk tests for normality}
shapiro_LPP <- function(condition, title) {
result <- shapiro.test(pull(filter(LPP_by_pid, block == condition))) %>% 
  pander(caption = title)
  }
```

```{r negative decrease}
shapiro_LPP("Neg_Dec", "Negative Decrease")
```

```{r negative increase}
shapiro_LPP("Neg_Inc", "Negative Increase")
```

```{r negative watch}
shapiro_LPP("Neg_Watch", "Negative Watch")
```

```{r neutral watch}
shapiro_LPP("Neu_Watch", "Neutral Watch")
```

```{r positive decrease}
shapiro_LPP("Pos_Dec", "Positive Decrease")
```
```{r positive increase}
shapiro_LPP("Pos_Inc", "Positive Increase")
```

```{r positive watch}
shapiro_LPP("Pos_Watch", "Positive Watch")
```

Several of the conditions have LPPs that are non-normally distributed with some outtliers. Let's inspect these extreme cases.

```{r examine extreme cases}
extreme_cases <- function(condition, name) {
(cases <- LPP_by_pid %>% 
  filter(block == condition,
         LPP > 17))
cases %>% 
  select(pid) %>% 
  pull()
}
# this outputs participants that have LPP amplitudes greater than 17, which denote the extreme cases we observed in the histograms and qqplots.
map2(conditions, cond_names, ~ extreme_cases(.x, .y))
```
Our extreme cases are 206201843 and 206201840. Let's inspect them
```{r}
per_erp %>% 
  filter(pid %in% c(206201843, 206201840))
```
Reviewing our EEG trial notes indicates that these two particpants were moving throughout the PER task and produced noisy data. Therefore, they will be removed from the dataset
```{r remove noisy participants}
LPP_pid_rem <- LPP_by_pid %>% 
  filter(!(pid %in% c(206201843, 206201840)))
# re-run normality tests to see what's going on
LPP_hist_qq <- function(cond, title) {
LPP_pid_rem %>% 
  filter(block == cond) %>% 
  gghistogram(., "LPP", title = title) %>% 
    print()
LPP_pid_rem %>% 
  filter(block == cond) %>% 
  ggqqplot(., "LPP", title = title)
}

conditions <- unique(LPP_by_pid$block)
cond_names <- c(paste("Negative", c("Decrease", "Increase", "Watch")), "Neutral Watch", paste("Positive", c("Decrease", "Increase", "Watch")))

map2(conditions, cond_names, ~ LPP_hist_qq(cond = .x, title = .y))
```

```{r shapiro wilk tests with filtered data}
shapiro_LPP <- function(condition, title) {
result <- shapiro.test(pull(filter(LPP_pid_rem, block == condition))) %>% 
  pander(caption = title)
}
map2(conditions, cond_names, ~ shapiro_LPP(.x, .y))
```

Next up, run bivariate analyses to observe nature of relationship between study variables.