---
title: "Regulation Block EEG Component Analyses"
author: "Ian Kahrilas"
date: "5/19/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(lmerTest)
library(here)
library(ggpubr)
library(car)
library(emmeans)
library(easystats)
library(welchADF)
library(moments)
library(modelbased)
library(patchwork)
library(report)
library(r2glmm)
# load in data
per_dat <- read_csv(here("data", "created_data", "per_data_analyses_2020_5_19.csv"))

# create dataset with lateralization variable
tmp <- per_dat %>% 
  pivot_longer(c("EPN_left", "EPN_right"), names_to = "lateralization", names_prefix = "EPN_", values_to = "EPN") %>% 
  select(-c(N170_right, N170_left))
tmp2 <- per_dat %>% 
  pivot_longer(c("N170_left", "N170_right"), names_to = "lateralization", names_prefix = "N170_", values_to = "N170") %>% 
  select(pid, block, N170, lateralization)
per_dat_lat <- left_join(tmp, tmp2, by = c("pid", "block", "lateralization")) %>% 
  select(pid:LPP, EPN, N170, lateralization, everything())

# create bilateral EPN and N170 variable to be used in initial analyses
per_dat <- per_dat %>% 
  mutate(N170 = (N170_left + N170_right) / 2,
         EPN = (EPN_left + EPN_right) / 2) %>% 
  select(pid:LPP, N170, EPN, everything())
```

# Characterizing relationship between regulation block conditions and EEG components

## Positive Regulation conditions and LPP

```{r LPP by passive block, warning=FALSE, message=FALSE}
# box and whisker plots for LPP and positive conditions
per_dat %>% 
  filter(block %in% c("Pos_Watch", "Pos_Dec", "Pos_Inc")) %>% 
  mutate(block = fct_relevel(block, c("Pos_Watch", 
                                      "Pos_Dec",
                                      "Pos_Inc"))) %>% # Change block order
  ggplot(., aes(block, LPP)) +
  geom_boxplot() + 
  ggtitle("LPP box and whisker plots for positive regulation blocks")

per_dat$block <- relevel(as.factor(per_dat$block), "Pos_Watch")
positive_lpp_mod <- lmer(LPP ~ block + (1|pid), data = per_dat)
# check the quality of the model
check_model(positive_lpp_mod, panel = FALSE)
summary(positive_lpp_mod)
r2beta(positive_lpp_mod)
report(positive_lpp_mod)

pairs(emmeans(positive_lpp_mod, "block"))
summary(aov(LPP ~ block, data = per_dat))
```

There are no significant differences in LPP for each positive block

## Positive conditions and EPN

```{r}
per_dat %>% 
  filter(block %in% c("Pos_Watch", "Pos_Dec", "Pos_Inc")) %>% 
  mutate(block = fct_relevel(block, c("Pos_Watch", 
                                      "Pos_Dec",
                                      "Pos_Inc"))) %>% # Change block order
  ggplot(., aes(block, EPN)) +
  geom_boxplot() + 
  ggtitle("EPN box and whisker plots for positive regulation blocks")

per_dat$block <- relevel(as.factor(per_dat$block), "Pos_Watch")
positive_epn_mod <- lmer(EPN ~ block + (1|pid), data = per_dat)
# check the quality of the model
check_model(positive_epn_mod, panel = FALSE)
summary(positive_epn_mod)
r2beta(positive_epn_mod)
report(positive_epn_mod)
```

There are strong differences between the positive increase and positive watch condition for EPN

## Positive conditions and N170

```{r}
per_dat %>% 
  filter(block %in% c("Pos_Watch", "Pos_Dec", "Pos_Inc")) %>% 
  mutate(block = fct_relevel(block, c("Pos_Watch", 
                                      "Pos_Dec",
                                      "Pos_Inc"))) %>% # Change block order
  ggplot(., aes(block, N170)) +
  geom_boxplot() + 
  ggtitle("N170 box and whisker plots for positive regulation blocks")

per_dat$block <- relevel(as.factor(per_dat$block), "Pos_Watch")
positive_n170_mod <- lmer(N170 ~ block + (1|pid), data = per_dat)
# check the quality of the model
check_model(positive_n170_mod, panel = FALSE)
summary(positive_n170_mod)
r2beta(positive_n170_mod)
report(positive_n170_mod)
```

There aresignificant differences between positive watch and positive increase, though likely won't withstand multiple-comparison adjustments.

## Negative regulation conditions and LPP

```{r}
# box and whisker plots for LPP and positive conditions
per_dat %>% 
  filter(block %in% c("Neg_Watch", "Neg_Dec", "Neg_Inc")) %>% 
  mutate(block = fct_relevel(block, c("Neg_Watch", 
                                      "Neg_Dec",
                                      "Neg_Inc"))) %>% # Change block order
  ggplot(., aes(block, LPP)) +
  geom_boxplot() + 
  ggtitle("LPP box and whisker plots for positive regulation blocks")

per_dat$block <- relevel(as.factor(per_dat$block), "Neg_Watch")
negative_lpp_mod <- lmer(LPP ~ block + (1|pid), data = per_dat)
# check the quality of the model
check_model(negative_lpp_mod, panel = FALSE)
summary(negative_lpp_mod)
r2beta(negative_lpp_mod)
report(negative_lpp_mod)
```

There are significant differences in LPP between the negative watch and negative increase conditions

## Negative regulation conditions and EPN

```{r}
# box and whisker plots for LPP and positive conditions
per_dat %>% 
  filter(block %in% c("Neg_Watch", "Neg_Dec", "Neg_Inc")) %>% 
  mutate(block = fct_relevel(block, c("Neg_Watch", 
                                      "Neg_Dec",
                                      "Neg_Inc"))) %>% # Change block order
  ggplot(., aes(block, EPN)) +
  geom_boxplot() + 
  ggtitle("EPN box and whisker plots for positive regulation blocks")

per_dat$block <- relevel(as.factor(per_dat$block), "Neg_Watch")
negative_epn_mod <- lmer(EPN ~ block + (1|pid), data = per_dat)
# check the quality of the model
check_model(negative_epn_mod, panel = FALSE)
summary(negative_epn_mod)
r2beta(negative_epn_mod)
report(negative_epn_mod)
```

There are no differences in EPN for the negative regulation blocks

## Negative regulation conditions and N170

```{r}
# box and whisker plots for LPP and positive conditions
per_dat %>% 
  filter(block %in% c("Neg_Watch", "Neg_Dec", "Neg_Inc")) %>% 
  mutate(block = fct_relevel(block, c("Neg_Watch", 
                                      "Neg_Dec",
                                      "Neg_Inc"))) %>% # Change block order
  ggplot(., aes(block, N170)) +
  geom_boxplot() + 
  ggtitle("N170 box and whisker plots for positive regulation blocks")

per_dat$block <- relevel(as.factor(per_dat$block), "Neg_Watch")
negative_n170_mod <- lmer(N170 ~ block + (1|pid), data = per_dat)
# check the quality of the model
check_model(negative_n170_mod, panel = FALSE)
summary(negative_n170_mod)
r2beta(negative_n170_mod)
report(negative_n170_mod)
```

No differences in N70 among negative regulation conditions

# Single model looking at all differences with pairwise comparisons

```{r}
# single emm model for all conditions
per_dat_cond <- per_dat %>% 
  separate(block, c("valence", "regulation"), "_") %>% 
  mutate(valence_condition = if_else(valence == "Neg", "Negative",
                           if_else(valence == "Pos", "Positive", "Neutral")),
         regulation_condition = if_else(regulation == "Dec", "Decrease",
                              if_else(regulation == "Inc", "Increase", "Watch")))

# LPP comparisons
reg_mod_lpp <- lmer(LPP ~ valence_condition * regulation_condition + (1|pid), data = per_dat_cond)
emmeans(reg_mod_lpp, pairwise ~ valence_condition | regulation_condition)
emmeans(reg_mod_lpp, pairwise ~ regulation_condition | valence_condition)

# EPN comparisons
reg_mod_epn <- lmer(EPN ~ valence_condition * regulation_condition + (1|pid), data = per_dat_cond)
emmeans(reg_mod_epn, pairwise ~ valence_condition | regulation_condition)
emmeans(reg_mod_epn, pairwise ~ regulation_condition | valence_condition)

# N170 comparisons
reg_mod_n170 <- lmer(N170 ~ valence_condition * regulation_condition + (1|pid), data = per_dat_cond)
emmeans(reg_mod_n170, pairwise ~ valence_condition | regulation_condition)
confint(emmeans(reg_mod_n170, pairwise ~ regulation_condition | valence_condition))
```


## Aim Two: LPP and Positive Affectivity

Derive contrasts between neutral watch and positive watch conditions and observe relationship between this contrast and positive affectivity, which is in line with the study hypothesis that the LPP contrast between the neutral watch and positive watch conditions will be moderated by positive affectivity

```{r pos affectivity contrasts, message=FALSE}
# function for deriving Wald confidence intervals for robust models
confint.rlmerMod <- function(object,parm,level=0.95) {
  beta <- fixef(object)
  if (missing(parm)) parm <- names(beta)
  se <- sqrt(diag(vcov(object)))
  z <- qnorm((1+level)/2)
  ctab <- cbind(beta-z*se,beta+z*se)
  colnames(ctab) <- stats:::format.perc(c((1-level)/2,(1+level)/2),
                                        digits=3)
  return(ctab[parm,])
}
# relevel block factor
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neu_Watch")
# fit model
mod_two_lpp <- lmerTest::lmer(LPP ~ block * scale(pos_affectivity, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
# check assumptions
check_model(mod_two_lpp, panel = FALSE)
summary(mod_two_lpp)
# some influential cases. try robust method for any differences in results
mod_two_lpp_rob <- rlmer(LPP ~ block * scale(pos_affectivity, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
confint.rlmerMod(mod_two_lpp_rob)

# check model two with EPN as outcome
mod_two_epn <- lmerTest::lmer(EPN ~ block * scale(pos_affectivity, center = TRUE, scale = FALSE) + lateralization + (1|pid), data = per_erp_filter_lat %>% filter(lateralization %in% c("left", "right")))
check_model(mod_two_epn, panel = FALSE)
summary(mod_two_epn)
# try robust model
mod_two_epn_rob <- rlmer(EPN ~ block * scale(pos_affectivity, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
summary(mod_two_epn_rob)
confint.rlmerMod(mod_two_epn_rob)

# check three-way interaction with lateralization as well
mod_two_epn_lat <- lmerTest::lmer(EPN ~ block * lateralization * scale(pos_affectivity, center = TRUE, scale = FALSE) + (1|lateralization:pid) + (lateralization|pid), data = per_erp_filter_lat)
check_model(mod_two_epn_lat, panel = FALSE)
summary(mod_two_epn_lat)
# robust model
mod_two_epn_lat_rob <- rlmer(EPN ~ block * lateralization * scale(pos_affectivity, center = TRUE, scale = FALSE) + (1|lateralization:pid) + (lateralization|pid), data = per_erp_filter_lat)
plot(modmod_two_epn_lat_rob)

# revised LPP selection
per_erp_rev$block <- relevel(per_erp_rev$block, "Neu_Watch")
mod_two_lpp_rev <- lmerTest::lmer(LPP ~ block * scale(pos_affectivity, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_rev)
check_model(mod_two_lpp_rev, panel = FALSE)
summary(mod_two_lpp_rev)
r2beta(mod_two_lpp_rev)
# Is LPP averaged across all conditions related to positive affectivity?
mod_lpp_avg_pa <- lmer(LPP ~ scale(neg_affectivity, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_rev)
summary(mod_lpp_avg_pa)

# check right frontal component
per_erp_lat$block <- relevel(per_erp_lat$block, "Neg_Watch")
right_pos_mod <- lmerTest::lmer(front_avr ~ block * scale(masq_pa, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_lat %>% filter(lateralization == "left"))
summary(right_pos_mod)

#----- old code, might be useful down the line.
# pos_watch_contrast <- per_erp_int %>% 
#   filter(block == "Neu_Watch") %>%
#   rename("LPP_neu_watch" = LPP) %>% 
#   select(-block)
# 
# tmp <- per_erp_int %>% 
#   filter(block == "Pos_Watch") %>% 
#   rename("LPP_pos_watch" = LPP) %>% 
#   select(pid, LPP_pos_watch)
# 
# pos_watch_contrast <- full_join(pos_watch_contrast, tmp, by = "pid") %>% 
#   mutate(contrast = LPP_pos_watch - LPP_neu_watch)
# 
# ggplot(pos_watch_contrast, aes(pos_affectivity, contrast)) +
#   geom_point() +
#   ggtitle("Positive affectivity and contrast between \nNeutral Watch and Positive Watch")
```

There doesn't appear to be any relationship between the two. We can derive a Pearson Product Moment correlation coefficient between contrasts and positive affectivity to validate this.

## LPP and savoring the  moment

Derive contrasts between positive watch and positive increase conditions and observe relationship between this contrast and savoring the moment, which is in line with the study hypothesis that the LPP contrast between the positive watch and positive increase conditions will be moderated by savoring the moment.

```{r savoring moment contrasts, message=FALSE}
# relevel block variable
per_erp_filter_lat$block <-  relevel(per_erp_filter_lat$block, "Pos_Watch")
per_erp_filter_lat$lateralization <- relevel(per_erp_filter_lat$lateralization, "right")
# model 3
mod_3_lpp <- lmerTest::lmer(LPP ~ block * scale(savoring_moment, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
check_model(mod_3_lpp, panel = FALSE)
summary(mod_3_lpp)
# check robust model
mod_3_lpp_rob <- rlmer(LPP ~ block * scale(savoring_moment, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
summary(mod_3_lpp_rob)
confint.rlmerMod(mod_3_lpp_rob)

# model 3 with EPN
mod_3_epn <- lmerTest::lmer(EPN ~ block * scale(savoring_moment, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
check_model(mod_3_epn)
summary(mod_3_epn)

#robust model
mod_3_epn_rob <- rlmer(EPN ~ block * scale(savoring_moment, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
summary(mod_3_epn_rob)

# revised lpp selection
per_erp_rev$block <-  relevel(per_erp_rev$block, "Pos_Watch")
mod_3_lpp_rev <- lmerTest::lmer(LPP ~ block * scale(savoring_moment, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_rev)
check_model(mod_3_lpp_rev, panel = FALSE)
summary(mod_3_lpp_rev)

# frontal component
per_erp_filter_lat$block <-  relevel(per_erp_filter_lat$block, "Pos_Watch")
mod_3_front <- lmerTest::lmer(front_avr ~ block * scale(pos_affectivity, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "right"))
check_model(mod_3_front, panel = FALSE)
summary(mod_3_front)

# test neg affectivity as moderator betwee negative regulation blocks
per_erp_lat$block <-  relevel(per_erp_lat$block, "Neg_Watch")
per_erp_filter_lat$block <-  relevel(per_erp_filter_lat$block, "Neg_Watch")
mod_front_neg_affect <- lmerTest::lmer(front_avr ~ block * scale(neg_affectivity, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "left"))
check_model(mod_front_neg_affect, panel = FALSE)
summary(mod_front_neg_affect)
mod_front_neg_rob <- rlmer(front_avr ~ block * scale(neg_affectivity, center = TRUE, scale = FALSE) + (1|pid), data = per_erp_lat %>% filter(lateralization == "left"))
confint.rlmerMod(mod_front_neg_rob)

#---- old code
# pos_inc_contrast <- per_erp_int %>% 
#   filter(block == "Pos_Watch") %>%
#   rename("LPP_pos_watch" = LPP) %>% 
#   select(-block)
# 
# tmp <- per_erp_int %>% 
#   filter(block == "Pos_Inc") %>% 
#   rename("LPP_pos_inc" = LPP) %>% 
#   select(pid, LPP_pos_inc)
# 
# pos_inc_contrast <- full_join(pos_inc_contrast, tmp, by = "pid") %>% 
#   mutate(contrast = LPP_pos_inc - LPP_pos_watch)
# 
# ggplot(pos_inc_contrast, aes(savoring_moment, contrast)) +
#   geom_jitter() +
#   ggtitle("Momentary savoring and contrast between \nPositive Watch and Positive Increase")
```

## EEG and arousal ratings

Scatterplot between EEG components and arousal ratings

```{r arousal ratings and LPP}
# LPP
per_erp_filter_lat %>% 
ggplot(., aes(arousal, LPP, color = lateralization)) +
  geom_jitter(width = 0.1, height = 0.1) +
  ggtitle("Arousal ratings and LPP") +
  geom_smooth(method = "lm", se = FALSE)
# EPN
per_erp_filter_lat %>% 
  ggplot(., aes(arousal, EPN, color = lateralization)) +
  geom_jitter(width = 0.1, height = 0.1) +
  ggtitle("Arousal ratings and EPN") +
  geom_smooth(method = "lm", se = FALSE)
# Centro-parietal LPP
per_erp_rev %>% 
  ggplot(., aes(arousal, LPP)) +
  geom_jitter(width = 0.1, height = 0.1) +$
  ggtitle("Arousal ratings and LPP") +
  geom_smooth(method = "lm", se = FALSE)
# frontal
per_erp_filter_lat %>% 
  filter(lateralization %in% c("right", "left")) %>% 
  ggplot(., aes(arousal, front_avr, color = lateralization)) +
  geom_jitter(width = 0.1, height = 0.1) +
  ggtitle("Arousal ratings and frontal component") +
  geom_smooth(method = "lm", se = FALSE)
```

There appears to be some positive relations. Let's test a linear model using MLM to account for the clustering between participants.

```{r eeg predicted by arousal}
mod_arousal_lpp <- lmerTest::lmer(LPP ~ arousal + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
summary(mod_arousal_lpp)
mod_arousal_lpp_rev <- lmerTest::lmer(LPP ~ arousal + (1|pid), data = per_erp_rev)
summary(mod_arousal_lpp_rev)
mod_arousal_epn <- lmerTest::lmer(EPN ~ arousal + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
summary(mod_arousal_epn)
right_frontal_arousal <- lmerTest::lmer(front_avr ~ arousal + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "right"))
summary(right_frontal_arousal)
left_frontal_arousal <- lmerTest::lmer(front_avr ~ arousal + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "left"))
summary(left_frontal_arousal)
```

## EEG and valence ratings

Scatterplot between LPP and valence ratings

```{r valence ratings and LPP, warning=FALSE, message=FALSE}
# LPP
per_erp_filter_lat %>% 
  filter(lateralization %in% c("left", "right")) %>% 
  mutate(lateralization = fct_relevel(lateralization, c("left", "right"))) %>% 
ggplot(., aes(valence, LPP, color = lateralization)) +
  geom_jitter(width = 0.1, height = 0.1) + 
  geom_smooth(se = FALSE) +
  ggtitle("Valence ratings and LPP")
# EPN
per_erp_filter_lat  %>% 
  filter(lateralization %in% c("left", "right")) %>% 
  mutate(lateralization = fct_relevel(lateralization, c("left", "right"))) %>%  
ggplot(., aes(valence, EPN, color = lateralization)) +
  geom_jitter(width = 0.1, height = 0.1) + 
  geom_smooth(se = FALSE) +
  ggtitle("Valence ratings and EPN")
# revised lpp
per_erp_rev %>% 
ggplot(., aes(valence, LPP)) +
  geom_jitter(width = 0.1, height = 0.1) + 
  geom_smooth(se = FALSE) +
  ggtitle("Valence ratings and centro-parietal LPP")
# frontal
per_erp_filter_lat %>% 
filter(lateralization %in% c("left", "right")) %>% 
  mutate(lateralization = fct_relevel(lateralization, c("left", "right"))) %>% 
ggplot(., aes(valence, front_avr, color = lateralization)) +
  geom_jitter(width = 0.1, height = 0.1) + 
  geom_smooth(se = FALSE) +
  ggtitle("Valence ratings and frontal component")
```

At first glance, there does not appear to be a relationship. However, it is hypothesized that more negatively- and positively-valenced images may positively correlate with LPP. Let's test this by fitting a polynomial regression line through the scatterplot.

```{r, message=FALSE, warning=FALSE}
# LPP
per_erp_filter_lat %>% 
    filter(lateralization %in% c("left", "right")) %>% 
ggplot(., aes(valence, LPP, color = lateralization)) +
  geom_jitter(width = 0.1, height = 0.1) + 
  stat_smooth(method = "lm", formula = y ~ poly(x, 2)) +
  ggtitle("Valence ratings and LPP")
# EPN
per_erp_filter_lat %>% 
    filter(lateralization %in% c("left", "right")) %>% 
ggplot(., aes(valence, EPN, color = lateralization)) +
  geom_jitter(width = 0.1, height = 0.1) + 
  stat_smooth(method = "lm", formula = y ~ poly(x, 2)) +
  ggtitle("Valence ratings and EPN")
# centro-parietal LPP
per_erp_rev %>% 
ggplot(., aes(valence, LPP)) +
  geom_jitter(width = 0.1, height = 0.1) + 
  stat_smooth(method = "lm", formula = y ~ poly(x, 2)) +
  ggtitle("Valence ratings and LPP")
```

Now, conduct a polynomial regression using MLM.

```{r}
mod_valence_lpp <- lmerTest::lmer(LPP ~ poly(valence, 2) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
summary(mod_valence_lpp)
check_model(mod_valence_lpp, panel = FALSE)
mod_valence_epn <- lmerTest::lmer(EPN ~ poly(valence, 2) * lateralization + (1|pid), data = per_erp_filter_lat %>% filter(lateralization %in% c("left", "right")))
summary(mod_valence_epn) #---- Three way interaction
mod_valence_lpp_rev <- lmerTest::lmer(LPP ~ poly(valence, 2) + (1|pid), data = per_erp_rev)
summary(mod_valence_lpp_rev)
front_right_valence <- lmerTest::lmer(front_avr ~ poly(valence, 2) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "right"))
summary(front_right_valence)
front_left_valence <- lmerTest::lmer(front_avr ~ poly(valence, 2) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "left"))
summary(front_left_valence)
```

Results indicate that there is a curvilinear relationship between LPP and arousal.

## LPP and difficulty ratings

Scatterplot between LPP and dificulty ratings.

```{r difficulty ratings and LPP, warning=FALSE, message=FALSE}
per_erp_filter_lat %>% 
  mutate(lateralization = fct_relevel(lateralization, c("left", "avg", "right"))) %>% 
ggplot(., aes(difficulty, LPP, color = lateralization)) +
  geom_jitter(width = 0.1, height = 0.1) + 
  geom_smooth(method = "lm", se = FALSE) +
  ggtitle("Difficulty ratings and LPP")
per_erp_filter_lat %>% 
  mutate(lateralization = fct_relevel(lateralization, c("left", "avg", "right"))) %>% 
ggplot(., aes(difficulty, EPN, color = lateralization)) +
  geom_jitter(width = 0.1, height = 0.1) + 
  geom_smooth(method = "lm", se = FALSE) +
  ggtitle("Difficulty ratings and EPN")
per_erp_rev %>%
ggplot(., aes(difficulty, LPP)) +
  geom_jitter(width = 0.1, height = 0.1) + 
  geom_smooth(method = "lm", se = FALSE) +
  ggtitle("Difficulty ratings and centroparietal LPP")
per_erp_filter_lat %>% 
  filter(lateralization %in% c("left", "right")) %>% 
  mutate(lateralization = fct_relevel(lateralization, c("left", "right"))) %>% 
  ggplot(., aes(difficulty, front_avr, color = lateralization)) +
  geom_jitter(width = 0.1, height = 0.1) + 
  geom_smooth(method = "lm", se = FALSE) +
  ggtitle("Difficulty ratings and frontal component")
```

There may be a slight linear relationship, though it is weak. Let's try fitting a linear model to test this.

```{r, warning=FALSE, message=FALSE}
mod_difficulty_lpp <- lmerTest::lmer(LPP ~ difficulty + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
check_model(mod_difficulty_lpp, panel = FALSE)
summary(mod_difficulty_lpp)
mod_difficulty_epn <- lmerTest::lmer(EPN ~ difficulty + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
summary(mod_difficulty_epn)
mod_difficulty_lpp_rev <- lmerTest::lmer(LPP ~ difficulty + (1|pid), data = per_erp_rev)
summary(mod_difficulty_lpp_rev)
mod_difficulty_front_left <- lmerTest::lmer(front_avr ~ difficulty + (1|pid), data = per_erp_filter_lat %>% filter(lateralization %in% c("left")))
summary(mod_difficulty_front_left)
mod_difficulty_front_right <- lmerTest::lmer(front_avr ~ difficulty + (1|pid), data = per_erp_filter_lat %>% filter(lateralization %in% c("right")))
summary(mod_difficulty_front_right)
# there is an interaction with Positive increase and difficulty for the left frontal component.
```

There does appear to be a positive relationship between the difficulty of the task and LPP.

## Valence and difficulty ratings

```{r, message=FALSE, warning=FALSE}
per_erp_filter_lat %>% 
  filter(lateralization == "avg") %>% 
ggplot(., aes(valence, difficulty)) +
  geom_jitter(height = 0.2, width = 0.2) + 
  geom_smooth() +
  ggtitle("Valence and difficulty ratings")
```

There doesn't appear to be a relationship between the two, but we can test this.

```{r, message=FALSE, warning=FALSE}
mod_diff_val <- lmerTest::lmer(difficulty ~ valence + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
summary(mod_diff_val)
mod_diff_val_poly <- lmerTest::lmer(difficulty ~ poly(valence, 2) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
summary(mod_diff_val_poly) # the polynomial term is non-significant
```

I stand corrected. There is a relationship. Let's check the effect size:

```{r}
r2beta(mod_diff_val)
```

## Valence and arousal

```{r, message=FALSE, warning=FALSE}
per_erp_filter_lat %>% 
  filter(lateralization == "avg") %>% 
ggplot(., aes(valence, arousal)) +
  geom_jitter(width = 0.3, height = 0.3) + 
  geom_smooth() +
#  geom_smooth(method = "lm") +
 # stat_smooth(method = "lm", formula = y ~ poly(x, 2), color = "red") +
  ggtitle("Valence and arousal ratings")
```

It looks like there is a strong curvilinear relationship between the two. 

```{r, message=FALSE, warning=FALSE}
mod_val_arousal <- lmerTest::lmer(arousal ~ poly(valence, 2) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
summary(mod_val_arousal)
report(mod_val_arousal)
r2beta(mod_val_arousal)
```

The MLM analysis confirms this relationship.

## Arousal and difficulty ratings

```{r, message=FALSE, warning=FALSE}
per_erp_filter_lat %>% 
  filter(lateralization == "avg") %>% 
ggplot(., aes(arousal, difficulty)) +
  geom_jitter(height = 0.3, width = 0.3) + 
  stat_smooth() +
  ggtitle("Arousal and difficulty ratings")
```

There is perhaps a curvilinear relationship. Let's model a locally weighted (green) and polynomial regression (red) line on the plot to see what the relationship is, and how well the polynomial regression line fits compared to the locally weighted one.

```{r, message=FALSE, warning=FALSE}
ggplot(filter(per_erp_filter_lat, lateralization == "avg"), aes(arousal, difficulty)) +
  geom_jitter(height = 0.3, width = 0.3) + 
  geom_smooth(color = "green", alpha = 0.2) +
  stat_smooth(method = "lm", formula = y ~ poly(x, 2), color = "red", alpha = 0.2) +
  ggtitle("Arousal and difficulty ratings")
```

It looks like the curvilnear relationship may be a good fit. Let's test it with an MLM analysis

```{r, warning=FALSE, message=FALSE}
mod_diff_arousal <- lmerTest::lmer(difficulty ~ poly(arousal, 2) + (1|pid), data = per_erp_filter_lat %>% filter(lateralization == "avg"))
summary(mod_diff_arousal)
r2beta(mod_diff_arousal)
```

Indeed, the results indicated that the relationship is curvilinear.

Exploration of traits and average EEG components collapsed across all groups.
```{r trait and average eeg exploration}
stm_lpp <- lmerTest::lmer(LPP ~ savoring_moment + lateralization + (1|pid), data = per_erp_filter_lat %>% filter(lateralization %in% c("left", "right")))
summary(stm_lpp)
pa_lpp <- lmerTest::lmer(LPP ~ pos_affectivity + (1|pid), data = per_erp_filter_lat %>% filter(lateralization %in% c("right", "left")))
summary(pa_lpp)
stm_epn <- lmerTest::lmer(EPN ~ savoring_moment + lateralization + (1|pid), data = per_erp_filter_lat %>% filter(lateralization %in% c("left", "right")))
summary(stm_epn)
pa_epn <- lmerTest::lmer(EPN ~ pos_affectivity + (1|pid), data = per_erp_filter_lat %>% filter(lateralization %in% c("left", "right")))
summary(pa_epn)
# revised lpp
stm_lpp_rev <- lmerTest::lmer(LPP ~ savoring_moment + (1|pid), data = per_erp_rev)
summary(stm_lpp_rev)
pa_lpp_rev <- lmerTest::lmer(LPP ~ pos_affectivity + (1|pid), data = per_erp_rev)
summary(pa_lpp_rev)
# right front
stm_front <- lmerTest::lmer(front_avr ~ savoring_moment*lateralization + (1|pid), data = per_erp_filter_lat %>%  filter(lateralization %in% c("right", "left")))
summary(stm_front)

stm_right_front <- lmerTest::lmer(front_avr ~ depression + (1|pid), data = per_erp_filter_lat %>% filter(lateralization %in% c("right")))
summary(stm_right_front)
```

# check out arousal/valence predicted by block/personality traits
## CONTINUE WITH THIS SECTION
```{r}
#---- POS_AFFECTIVITY
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neu_Watch")
mod_arousal_pa <- lmerTest::lmer(arousal ~ block * pos_affectivity + (1|pid), data = per_erp_filter_lat)
summary(mod_arousal_pa)
## interaction between arousal ratings and positive affecitivity
mod_valence_pa <- lmerTest::lmer(valence ~ block * pos_affectivity + (1|pid), data = per_erp_filter_lat)
summary(mod_valence_pa)
## interaction between valence ratings and positive affectivity

#----- SAVORING THE MOMENT
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Pos_Watch")
mod_arousal_stm <- lmerTest::lmer(arousal ~ block * savoring_moment + (1|pid), data = per_erp_filter_lat)
summary(mod_arousal_stm)
mod_arousal_stm <- lmerTest::lmer(valence ~ block * savoring_moment + (1|pid), data = per_erp_filter_lat)
summary(mod_arousal_stm)
## no interactions for savoring the moment

#---- DEPRESSION
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neu_Watch")
mod_arousal_dep <- lmerTest::lmer(arousal ~ depression + (1|pid), data = per_erp_filter_lat)
summary(mod_arousal_dep)
# nothing
mod_arousal_dep_block <- lmerTest::lmer(arousal ~ block * depression + (1|pid), data = per_erp_filter_lat)
summary(mod_arousal_dep_block)
# nothing
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Pos_Watch")
mod_valence_dep <- lmerTest::lmer(valence ~ depression + (1|pid), data = per_erp_filter_lat)
summary(mod_valence_dep)
mod_valence_dep_block <- lmerTest::lmer(valence ~ block*depression + (1|pid), data = per_erp_filter_lat)
summary(mod_valence_dep_block)
# nothing
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neg_Watch")
mod_arousal_dep_block_neg <- lmerTest::lmer(arousal ~ block * depression + (1|pid), data = per_erp_filter_lat)
summary(mod_arousal_dep_block_neg)

#--- ERQ SUBSCALES - LOOK AT VALENCE TOO
# reappraisal arousal
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neg_Watch")
mod_arousal_reappraisal <- lmerTest::lmer(arousal ~ erq_reappraisal + (1|pid), data = per_erp_filter_lat)
summary(mod_arousal_reappraisal)
mod_arousal_reappraisal_block <- lmerTest::lmer(arousal ~ block*erq_reappraisal + (1|pid), data = filter(per_erp_filter_lat, block %in% c("Neg_Watch", "Neg_Inc", "Neg_Dec")))
summary(mod_arousal_reappraisal_block)
# nothing here
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Pos_Watch")
mod_arousal_reappraisal_block_pos <- lmerTest::lmer(arousal ~ block*erq_reappraisal + (1|pid), data = filter(per_erp_filter_lat, block %in% c("Pos_Watch", "Pos_Inc", "Pos_Dec")))
summary(mod_arousal_reappraisal_block_pos)
## interactin for erq with pos_dec vs. watch and arousal
# reappraisal valence
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neg_Watch")
mod_valence_reappraisal <- lmerTest::lmer(valence ~ erq_reappraisal + (1|pid), data = per_erp_filter_lat)
summary(mod_valence_reappraisal)
mod_valence_reappraisal_block <- lmerTest::lmer(valence ~ block*erq_reappraisal + (1|pid), data = filter(per_erp_filter_lat, block %in% c("Neg_Watch", "Neg_Inc", "Neg_Dec")))
summary(mod_arousal_reappraisal_block)
# interaction between negative increase and erq suppression - not what would be suspected
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Pos_Watch")
mod_valence_reappraisal_block_pos <- lmerTest::lmer(valence ~ block*erq_reappraisal + (1|pid), data = filter(per_erp_filter_lat, block %in% c("Pos_Watch", "Pos_Inc", "Pos_Dec")))
summary(mod_valence_reappraisal_block_pos)
# intearction between positive decrease and erq reappraisal
## interactin for erq with pos_dec vs. watch and arousal

# suppression - LOOK AT VALENCE???
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neg_Watch")
mod_arousal_reappraisal <- lmerTest::lmer(arousal ~ erq_suppression + (1|pid), data = per_erp_filter_lat)
summary(mod_arousal_reappraisal)
mod_arousal_reappraisal_block <- lmerTest::lmer(arousal ~ block*erq_suppression + (1|pid), data = filter(per_erp_filter_lat, block %in% c("Neg_Watch", "Neg_Inc", "Neg_Dec")))
summary(mod_arousal_reappraisal_block)
# Interaction between neg inc vs. neg watch and arousal by suppression - doesn't make a whole lot of sense
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Pos_Watch")
mod_arousal_reappraisal_block_pos <- lmerTest::lmer(arousal ~ block*erq_suppression + (1|pid), data = filter(per_erp_filter_lat, block %in% c("Pos_Watch", "Pos_Inc", "Pos_Dec")))
summary(mod_arousal_reappraisal_block_pos)
# nothing
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neg_Watch")
mod_arousal_reappraisal <- lmerTest::lmer(valence ~ erq_suppression + (1|pid), data = per_erp_filter_lat)
summary(mod_arousal_reappraisal)
mod_arousal_reappraisal_block <- lmerTest::lmer(arousal ~ block*erq_suppression + (1|pid), data = filter(per_erp_filter_lat, block %in% c("Neg_Watch", "Neg_Inc", "Neg_Dec")))
summary(mod_arousal_reappraisal_block)
# Interaction between neg inc vs. neg watch and arousal by suppression - doesn't make a whole lot of sense
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Pos_Watch")
mod_arousal_reappraisal_block_pos <- lmerTest::lmer(arousal ~ block*erq_suppression + (1|pid), data = filter(per_erp_filter_lat, block %in% c("Pos_Watch", "Pos_Inc", "Pos_Dec")))
summary(mod_arousal_reappraisal_block_pos)
# nothing

## suppression and valence
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neg_Watch")
mod_valence_reappraisal <- lmerTest::lmer(valence ~ erq_suppression + (1|pid), data = per_erp_filter_lat)
summary(mod_arousal_reappraisal)
mod_valence_reappraisal_block <- lmerTest::lmer(valence ~ block*erq_suppression + (1|pid), data = filter(per_erp_filter_lat, block %in% c("Neg_Watch", "Neg_Inc", "Neg_Dec")))
summary(mod_valence_reappraisal_block)
# Interaction between neg inc vs. neg watch and arousal by suppression - doesn't make a whole lot of sense

#----- TMMS Subscales
## repair
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neu_Watch")
arousal_repair <- lmerTest::lmer(arousal ~ tmms_repair + (1|pid), data = per_erp_filter_lat)
summary(arousal_repair)
# nothing
arousal_repair_block <- lmerTest::lmer(arousal ~ block*tmms_repair + (1|pid), data = per_erp_filter_lat)
summary(arousal_repair_block)
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neg_Watch")
arousal_repair_block_neg <- lmerTest::lmer(arousal ~ block*tmms_repair + (1|pid), data = per_erp_filter_lat)
summary(arousal_repair_block_neg)
# interactions between TMMS subscale and neg_watch vs. Neg_dec - cool
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Pos_Watch")
arousal_repair_block_pos <- lmerTest::lmer(arousal ~ block*tmms_repair + (1|pid), data = per_erp_filter_lat)
summary(arousal_repair_block_pos)
# nothing for positive
# look at valence 
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neu_Watch")
valence_repair <- lmerTest::lmer(valence ~ tmms_repair + (1|pid), data = per_erp_filter_lat)
summary(valence_repair)
# nothing
valence_repair_block <- lmerTest::lmer(valence ~ block*tmms_repair + (1|pid), data = per_erp_filter_lat)
summary(valence_repair_block)
# interactions between passive watch conditions here
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Neg_Watch")
valence_repair_block_neg <- lmerTest::lmer(valence ~ block*tmms_repair + (1|pid), data = per_erp_filter_lat)
summary(valence_repair_block_neg)
# interactions here between neg ince vs. neg watch and tmms repair
per_erp_filter_lat$block <- relevel(per_erp_filter_lat$block, "Pos_Watch")
valence_repair_block_pos <- lmerTest::lmer(valence ~ block*tmms_repair + (1|pid), data = per_erp_filter_lat)
summary(valence_repair_block_pos)
# nothing here of interest
## attention
## suppression
```

```{r descriptive statistics}
# sex
per_erp %>% 
  distinct(sex) %>% 
  ungroup() %>% 
  count(sex)

# age
range(per_erp$age)
mean(per_erp$age)
sd(per_erp$age)

# race
per_erp %>% 
  distinct(Race) %>% 
  ungroup() %>% 
  count(Race) %>% 
  mutate(percentage = n / sum(n))

# ethnicity
per_erp %>% 
  distinct(ethnicity) %>% 
  ungroup() %>% 
  count(ethnicity) %>% 
  mutate(percentage = n / sum(n))
```